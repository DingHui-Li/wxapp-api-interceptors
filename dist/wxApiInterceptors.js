'use strict';

var regeneratorRuntime = require('./runtime');

var _typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a},_extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a};function _asyncToGenerator(a){return function(){var b=a.apply(this,arguments);return new Promise(function(c,d){function f(g,h){try{var j=b[g](h),k=j.value}catch(l){return void d(l)}return j.done?void c(k):Promise.resolve(k).then(function(l){f('next',l)},function(l){f('throw',l)})}return f('next')})}}module.exports=function(){var a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},b=_extends({},wx);wx=new Proxy({},{get:function get(c,d){var f=this;return'request'===d?c.request:'old'===d?b:function(){for(var h=arguments.length,g=Array(h),j=0;j<h;j++)g[j]=arguments[j];var _arg$=g[0],k=_arg$===void 0?{}:_arg$,l=function(){var m=_asyncToGenerator(regeneratorRuntime.mark(function n(){var u=0<arguments.length&&arguments[0]!==void 0&&arguments[0],o,p,q,r,s,t;return regeneratorRuntime.wrap(function(w){for(;;)switch(w.prev=w.next){case 0:if(o=function resFn(x,y){y(x)},!a[d]){w.next=21;break}if(p=a[d],q=p.request,r=void 0===q?function(){return k}:q,s=p.response,t=void 0===s?function(x){return x}:s,w.prev=3,!u){w.next=8;break}w.t1=r(k),w.next=11;break;case 8:return w.next=10,r(k);case 10:w.t1=w.sent;case 11:if(w.t0=w.t1,w.t0){w.next=14;break}w.t0=k;case 14:k=w.t0,w.next=20;break;case 17:throw w.prev=17,w.t2=w['catch'](3),console.error(w.t2);case 20:o=function(){var x=_asyncToGenerator(regeneratorRuntime.mark(function y(z,A){return regeneratorRuntime.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!u){C.next=4;break}C.t1=t(z),C.next=7;break;case 4:return C.next=6,t(z);case 6:C.t1=C.sent;case 7:if(C.t0=C.t1,C.t0){C.next=10;break}C.t0=z;case 10:z=C.t0,A(z);case 12:case'end':return C.stop();}},y,f)}));return function resFn(){return x.apply(this,arguments)}}();case 21:return w.abrupt('return',o);case 22:case'end':return w.stop();}},n,f,[[3,17]])}));return function(){return m.apply(this,arguments)}}();if(a[d]&&!b.canIUse(d+'.success')&&'showLoading'!==d)l(!0),g[0]=k;else if(b.canIUse(d+'.success'||'showLoading'===d)||a[d])return new Promise(function(){var m=_asyncToGenerator(regeneratorRuntime.mark(function n(o,p){var q,r,s,t,u,v;return regeneratorRuntime.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return q=k,r=q.success,s=void 0===r?function(){return''}:r,t=q.fail,u=void 0===t?function(){return''}:t,x.next=3,l();case 3:v=x.sent,b[d](Object.assign(k,{success:function success(y){return v(y,function(z){o(z),s(z)})},fail:function fail(y){return v(y,function(z){p(z),u(z)})}}));case 5:case'end':return x.stop();}},n,f)}));return function(){return m.apply(this,arguments)}}());return b[d].apply(b,g)}}}),wx.request=new Proxy(function(){var c=_asyncToGenerator(regeneratorRuntime.mark(function d(f){var j=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},g,h;return regeneratorRuntime.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if('object'===('undefined'==typeof f?'undefined':_typeof(f))&&(j=f,f=f.url),!a.request){l.next=15;break}return g=a.request.request,h=void 0===g?function(m){return m}:g,l.prev=3,l.next=6,h(_extends({},j,{url:f}));case 6:if(l.t0=l.sent,l.t0){l.next=9;break}l.t0=j;case 9:j=l.t0,l.next=15;break;case 12:throw l.prev=12,l.t1=l['catch'](3),console.error(l.t1);case 15:return l.abrupt('return',new Promise(function(m,n){var t=function(){var u=_asyncToGenerator(regeneratorRuntime.mark(function v(w,x){var y,z,A,B;return regeneratorRuntime.wrap(function(D){for(;;)switch(D.prev=D.next){case 0:if(y=w,z=y.statusCode,!a.request){D.next=16;break}return A=a.request.response,B=void 0===A?function(){return w}:A,D.prev=3,D.next=6,B(w);case 6:if(D.t0=D.sent,D.t0){D.next=9;break}D.t0=w;case 9:w=D.t0,D.next=16;break;case 12:D.prev=12,D.t1=D['catch'](3),n(D.t1),s(D.t1);case 16:if(!(400<=z)){D.next=20;break}return n(w),s(w),D.abrupt('return');case 20:x(w);case 21:case'end':return D.stop();}},v,this,[[3,12]])}));return function(){return u.apply(this,arguments)}}(),o=j,p=o.success,q=void 0===p?function(){return''}:p,r=o.fail,s=void 0===r?function(){return''}:r;b.request(Object.assign(j,{success:function success(u){return t(u,function(v){q(v),m(v)})},fail:function fail(u){return t(u,function(v){s(v),n(v)})}}))}));case 16:case'end':return l.stop();}},d,void 0,[[3,12]])}));return function(){return c.apply(this,arguments)}}(),{get:function get(c,d){return function(f){var g=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return g.success||g.fail?b.request(g):(Object.assign(g,{method:d}),wx.request(f,g))}}})};
